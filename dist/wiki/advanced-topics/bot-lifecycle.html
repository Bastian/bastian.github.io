<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bot Lifecycle | Javacord</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon-96x96.png">
    <meta name="description" content="The Javacord website">
    <link rel="preload" href="/assets/css/0.styles.a1fb650d.css" as="style"><link rel="preload" href="/assets/js/app.2a4b19a4.js" as="script"><link rel="preload" href="/assets/js/2.794a2b38.js" as="script"><link rel="preload" href="/assets/js/9.0a9764f6.js" as="script"><link rel="prefetch" href="/assets/js/10.dad849ea.js"><link rel="prefetch" href="/assets/js/11.d7cac204.js"><link rel="prefetch" href="/assets/js/12.a99823d7.js"><link rel="prefetch" href="/assets/js/13.b485f8a2.js"><link rel="prefetch" href="/assets/js/14.c6106768.js"><link rel="prefetch" href="/assets/js/15.3c7cdeb1.js"><link rel="prefetch" href="/assets/js/16.d3093f40.js"><link rel="prefetch" href="/assets/js/17.e3d00990.js"><link rel="prefetch" href="/assets/js/18.7cc0cf75.js"><link rel="prefetch" href="/assets/js/19.71f6eee7.js"><link rel="prefetch" href="/assets/js/20.0808a7b9.js"><link rel="prefetch" href="/assets/js/21.8aba7b32.js"><link rel="prefetch" href="/assets/js/22.74941ef1.js"><link rel="prefetch" href="/assets/js/23.0c7d26dc.js"><link rel="prefetch" href="/assets/js/24.ada02605.js"><link rel="prefetch" href="/assets/js/25.2339a445.js"><link rel="prefetch" href="/assets/js/26.5744d686.js"><link rel="prefetch" href="/assets/js/27.2f096731.js"><link rel="prefetch" href="/assets/js/28.9a10c7da.js"><link rel="prefetch" href="/assets/js/3.74618a5c.js"><link rel="prefetch" href="/assets/js/4.2e7eda08.js"><link rel="prefetch" href="/assets/js/5.0e628205.js"><link rel="prefetch" href="/assets/js/6.fdef01cf.js"><link rel="prefetch" href="/assets/js/7.e90e4683.js"><link rel="prefetch" href="/assets/js/8.53ed1a19.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a1fb650d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Javacord</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/wiki/" class="nav-link router-link-active">
  Wiki
</a></div><div class="nav-item"><a href="https://docs.javacord.org/" target="_self" rel="" class="nav-link external">
  JavaDocs
  <!----></a></div><div class="nav-item"><a href="https://discord.gg/0qJ2jjyneLEgG7y3" target="_self" rel="" class="nav-link external">
  Discord Server
  <!----></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/wiki/" class="nav-link router-link-active">
  Wiki
</a></div><div class="nav-item"><a href="https://docs.javacord.org/" target="_self" rel="" class="nav-link external">
  JavaDocs
  <!----></a></div><div class="nav-item"><a href="https://discord.gg/0qJ2jjyneLEgG7y3" target="_self" rel="" class="nav-link external">
  Discord Server
  <!----></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wiki/getting-started/" class="sidebar-link">Intro</a></li><li><a href="/wiki/getting-started/download-installation.html" class="sidebar-link">Download / Installation</a></li><li><a href="/wiki/getting-started/creating-a-bot-account.html" class="sidebar-link">Creating a Bot Account</a></li><li><a href="/wiki/getting-started/writing-your-first-bot.html" class="sidebar-link">Writing your first bot</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Beginner IDE Setup</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Basic Tutorials</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wiki/basic-tutorials/listeners.html" class="sidebar-link">Listeners</a></li><li><a href="/wiki/basic-tutorials/embeds.html" class="sidebar-link">Embeds</a></li><li><a href="/wiki/basic-tutorials/emojis-and-reactions.html" class="sidebar-link">Emojis and Reactions</a></li><li><a href="/wiki/basic-tutorials/message-builder.html" class="sidebar-link">Using the MessageBuilder</a></li><li><a href="/wiki/basic-tutorials/creating-entities.html" class="sidebar-link">Creating Channels, Invites, etc.</a></li><li><a href="/wiki/basic-tutorials/logger-config.html" class="sidebar-link">Logger Configuration</a></li><li><a href="/wiki/basic-tutorials/glossary.html" class="sidebar-link">Glossary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Advanced Topics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wiki/advanced-topics/bot-lifecycle.html" class="active sidebar-link">Bot Lifecycle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wiki/advanced-topics/bot-lifecycle.html#the-four-states" class="sidebar-link">4Ô∏è‚É£ The four states</a></li><li class="sidebar-sub-header"><a href="/wiki/advanced-topics/bot-lifecycle.html#how-to-handle-disconnects" class="sidebar-link">üîÅ How to handle disconnects</a></li></ul></li><li><a href="/wiki/advanced-topics/entity-cache.html" class="sidebar-link">Entity Cache</a></li><li><a href="/wiki/advanced-topics/ratelimits.html" class="sidebar-link">Ratelimits</a></li><li><a href="/wiki/advanced-topics/sharding.html" class="sidebar-link">Sharding</a></li><li><a href="/wiki/advanced-topics/performance-tweaks.html" class="sidebar-link">Performance Tweaks</a></li><li><a href="/wiki/advanced-topics/proxies.html" class="sidebar-link">Proxies</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Essential Knowledge</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wiki/essential-knowledge/lambdas.html" class="sidebar-link">Lambdas</a></li><li><a href="/wiki/essential-knowledge/optionals.html" class="sidebar-link">Optionals</a></li><li><a href="/wiki/essential-knowledge/completable-futures.html" class="sidebar-link">Completable Futures</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="bot-lifecycle"><a href="#bot-lifecycle" class="header-anchor">#</a> Bot Lifecycle</h1> <p>It's important to know the life-cycle of a discord bot to properly handle disconnects.
The following state diagram shows the 4 states a bot can have:</p> <p><img src="https://javacord.org/img/tutorials/bot-life-cycle/state-diagram.svg" alt=""></p> <h2 id="the-four-states"><a href="#the-four-states" class="header-anchor">#</a> 4Ô∏è‚É£ The four states</h2> <h3 id="connected"><a href="#connected" class="header-anchor">#</a> Connected</h3> <p>The bot is connected to the websocket and receives all events.</p> <h3 id="disconnected"><a href="#disconnected" class="header-anchor">#</a> Disconnected</h3> <p>The bot is not connected to the websocket and receives no events. It's not uncommon for a bot to occasionally lose connection.
This can have various reasons, for example:</p> <ul><li>Your bot lost its internet connection</li> <li>Discord restarted the gateway server you are currently connected to</li> <li>A plane crashed into Discord's data center</li></ul> <p>The bot will periodically try ro resume/reconnect to the websocket. It will start with a small frequency and increase it
with every failed reconnect attempt. You can modify this reconnect delay with the <code>DiscordApi#setReconnectDelay(...)</code> method.
The following example code would increase the delay linearly.
The 1st attempt would be delayed for <code>2</code> seconds, the 2nd attempt for <code>4</code> seconds, the 3rd attempts for <code>6</code> seconds, ...</p> <div class="language-java extra-class"><pre class="language-java"><code>api<span class="token punctuation">.</span><span class="token function">setReconnectDelay</span><span class="token punctuation">(</span>attempt <span class="token operator">-&gt;</span> attempt <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Important:</strong> Bots can only reconnect 1000 times in a 24-hour period (every ~90 seconds). This limit is global and across all shards.
Upon hitting this limit, all active sessions for the bot will be terminated, the bot's token will be reset, and
you will receive an email notification. This is the reason Javacord increases the reconnect delay with every attempt.</p></blockquote> <p>By default, the following formula is used to calculate the reconnect delay:</p> <p><img src="https://javacord.org/img/tutorials/bot-life-cycle/reconnect-delay.png" alt=""></p> <p>For shard <code>0</code>, the delays will look like this:</p> <table><thead><tr><th>Attempt</th> <th>Delay</th></tr></thead> <tbody><tr><td>1</td> <td>1</td></tr> <tr><td>2</td> <td>2</td></tr> <tr><td>3</td> <td>4</td></tr> <tr><td>4</td> <td>6</td></tr> <tr><td>5</td> <td>7</td></tr> <tr><td>...</td> <td>...</td></tr> <tr><td>10</td> <td>16</td></tr> <tr><td>15</td> <td>23</td></tr> <tr><td>20</td> <td>30</td></tr> <tr><td>...</td> <td>...</td></tr> <tr><td>50</td> <td>59</td></tr> <tr><td>100</td> <td>91</td></tr> <tr><td>150</td> <td>115</td></tr> <tr><td>...</td> <td>...</td></tr></tbody></table> <h3 id="resuming"><a href="#resuming" class="header-anchor">#</a> Resuming</h3> <p>Resuming is only possible for a short time after being disconnected. If the bot can successfully resume the connection,
you will not miss any events. Your bot will receive all events you missed while being disconnected. The cache gets updated
accordingly.</p> <h3 id="reconnecting"><a href="#reconnecting" class="header-anchor">#</a> Reconnecting</h3> <p>If your bot reconnects (not resumes!), the whole cache gets wiped and you will not receive any missed events.</p> <p><strong>What does this mean?</strong></p> <ul><li>References to entities (e.g. a <code>Server</code>, <code>User</code>, <code>Channel</code>, ...) will be outdated. This is why you should never store
entities, but the id instead. See <a href="http://localhost:4000/wiki/advanced-tutorials/entity-cache/#how-long-are-cached-entities-valid" target="_blank" rel="noopener noreferrer">Entity Cache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>You will miss events. There's no way to receive the missed events.</li> <li>Listeners attached to entities will <strong>not</strong> be affected, because they are bound to the entity's id, not the object itself.</li></ul> <h2 id="how-to-handle-disconnects"><a href="#how-to-handle-disconnects" class="header-anchor">#</a> üîÅ How to handle disconnects</h2> <p>For most bots, there's nothing you have to do. All registered listeners are reconnect-resistant, which means if your bot
is only reacting to events, it will work fine after a restart. For example, the following code will not be affected by a
reconnect (besides maybe some missed <code>!ping</code> messages):</p> <div class="language-java extra-class"><pre class="language-java"><code>api<span class="token punctuation">.</span><span class="token function">addMessageCreateListener</span><span class="token punctuation">(</span>event <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;!ping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        event<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Pong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In case you want to handle reconnects (e.g. fetch the message history to detect missed messages), there are
special connection-related listeners which can be used to track the state of the bot:</p> <ul><li><code>LostConnectionListener</code></li> <li><code>ReconnectListener</code></li> <li><code>ResumeListener</code></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/wiki/basic-tutorials/glossary.html" class="prev">
        Glossary
      </a></span> <span class="next"><a href="/wiki/advanced-topics/entity-cache.html">
        Entity Cache
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2a4b19a4.js" defer></script><script src="/assets/js/2.794a2b38.js" defer></script><script src="/assets/js/9.0a9764f6.js" defer></script>
  </body>
</html>
